# 设备管理
9.1 设备文件
Linux 中，用户是通过文件系统与设备连接的。每个设备都是在其驱动程序控制下运行
的，驱动程序则与/dev 目录下的特殊文件联系在一起，在选择设备或者操作设备时都以这
个文件的名称来代表这一设备。
Linux 系统采用___设备文件___ 统一管理硬件设备,从而将硬件设备的特性及管理细节对
用户隐藏，实现用户程序与设备无关性。从用户的角度来看；对设备的使用和一般文件的
使用一样。
设备的命名规则：在/dev 目录下，每一个驱动器以一个单独的设备文件来表现；设备
的文件名一般由两部分组成，第一部分是 主设备号 ，第二部分是 次设备号 。主设备号代
表设备的类型，如 hd 表示 IDE 硬盘，sd 表示 SCSI 硬盘，tty 表示终端设备等；次设备号代
表同类设备中的序号，如 IDE 硬盘一般可以有 4 个，即/dev/hda、/dev/hdb、/dev/hdc、
/dev/hdd，a 代表第一个设备，hda1 中的”1”代表 had 的第一个硬盘主分区，以此类推。
SCSI 硬盘就是/dev/sda、/dev/sdb 等。fd 是软盘，设备名称是/dev/fd0。Linux 系统中，磁
带机的设备名是/dev/st*和/dev/nst*，其中 nst*是指操作完成后不自动回卷磁带，st*自动回
卷磁带，常用 nst*。主机 SCSI 总线上找到的第一个磁带机是 nst0 或 st0，第二个是 nst1 或
st1，依此类推。磁带机的 SCSI 号越小，其设备名也就越靠前。
一台主机上可以有多块硬盘，系统采用 a~p 来代表 16 块不同的硬盘，硬盘的分区编
号规则：主分区或扩展分区的编号从 1 开始，到 4 结束；逻辑分区从编号 5 开始。
硬盘设备有大量的扇区组成的，第一个扇区最重要，里面保存着主引导记录与分区表
信息。主引导记录（信息） 需要占用 446 字节，分区表为 64 字节，结束符占用 2 字节；
跟去表中没记录一个分区信息就需要 16 字节，最多只有 4 个分区信息可以写到第一个扇区
中，这 4 个分区就是 4 个主分区。
/dev/null 文件是空设备，等价于一个只写文件，所有写入它的内容都会永远丢失。读取数
据返回为空。
/dev/zero 也是一个伪文件，是一个输入设备。主要用处是创建一个指定长度的初始化空文
件。
/dev/full 是一个特殊的设备文件，在向其写入时总是返回“设备无剩余空间”（错误码为
ENPOSPC），读取时则与/dev/zero 相似，放回无限的二进制流。常被用来测试程序在遇到
磁盘无剩余空间错误时的行为
/dev/random[urandom]用作随机数发生器或伪随机数发生器。
Linux 系统采用 设备文件 统一管理硬件设备。
按照是否对应物理实体，设备可以分为两种：物理设备，虚拟设备。
9.2 常用的设备命令
系统启动时会检测主机硬件并加载适当的驱动程序（模块，modules），让硬件正确地启动
与运行。内核所检测到的各项硬件设备，会记录在/proc 中
9.2.1 查看 CPU 信息的命令
lscpu 命令 查看 CPU 和处理单元的信息
9.2.2 查看内存信息的命令
最常用命令 free，查看虚拟内存最常用命令 vmstat
1. free 命令
显示系统内存状态，包括空闲的和已用的物流内存，swap 内存，以及被内核使用的缓
冲区。
-k：以 KB 为单位，显示内存的使用情况，默认选项
-b：以字节为单位，显示内存使用情况
-m：以 MB 为单位，显示
-g：以 GB 为单位
-t：在输出的最终结果中，输出内存和 swap 分区的总量
-o：不显示系统缓冲区这一列
-s：间隔秒数：根据指定的间隔时间，持续显示内存使用情况
Swap 指的是交换分区，也就是虚拟内存。
2. vmstat 命令
Virtual Meomory Statistics 虚拟内存统计。Linux 内存管理主要通过“调页（Paging）”和” 交换（Swapping）”来完成内存调度。
页面写入磁盘的过程称作 Page-Out，页面从磁盘重新回到内存的过程被称作 Page-In。
当内核需要一个页面，但发现此页面不在物理内存中（因为被 Page-Out）时，就发生
页面错误（Page Fault）。若 pageout 频繁发生，内核管理分页的时间超过运行程序的
时间时，系统性能会急剧下降。这时系统已经运行非常慢或进入暂停状态，这种状态
亦被称作颠簸 Thrashing
9.2.3 查看块设备的命令
1. dmesg 命令
--可以查看 Linux 系统启动信息的命令
常用于查看系统的硬件信息。除此之外，开机信息也可以通过/var/log/目录中的 dmesg 文
件查看。
2. lsblk 命令
列出系统中的所有可用块设备信息，还能显示他们之间的依赖关系，但不会列出 RAM 盘的
信息。块设备如，硬盘、闪存盘、CD-ROM 等。
块设备指设备将数据按可寻址的块为单位进行输入/输出，一次 I/O 操作固定大小的数据块，
通过缓冲区来读写块设备，允许随机访问。这种方式适用于发送大量的信息，常见的块设
备有硬盘、磁盘、光盘驱动器等。
9.2.4 磁盘配额的命令
1. quota 命令
查询磁盘空间的限制，并得知已使用多少空间。
quota [选项] 用户名
quota [选项] 群组名
2. quotacheck 命令
扫描文件系统（必须含有挂载参数 usrquota 和 grpquota）并建立磁盘配额记录文件。
quotacheck [选项] 文件系统
3. quotaon 命令
启动磁盘配额服务。
4. quotaoff 命令
关闭磁盘配额服务。