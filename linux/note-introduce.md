# Linux系统基础知识

## 操作系统的概念、功能、组成和基本原理

操作系统管理着整个计算机系统的软硬件资源，并提供用户与计算机系统交互的操作界面。

### 操作系统为用户提供的服务

- 程序开发
- 程序运行
- I/O设备访问
- 文件访问
- 系统资源的访问
- 错误检测和响应
- 日志服务

### 从资源角度看操作系统五大功能

- 处理器管理
- 存储器管理
- I/O设备管理
- 文件管理
- 作业管理

### 操作系统基本特征

- **并发**：操作系统最重要的特征，指同一时间间隔发生的多个事件。
- **共享**：与并发是操作系统最基本的两个特征，资源共享分为互斥共享方式和同时访问方式。
- **虚拟**：把一个物理上的实体变为一个或多个逻辑上的对应物。
- **异步**：又称随机性或不确定性，指在相同的计算机环境和初始条件下，在同一数据集上运行的同一程序每次执行的顺序和所需时间都不一定相同。

> 注：并行指在同一时刻发生；在同一时间内只允许一个进程访问的资源称为临界资源。

## 计算机相关基础
### 冯诺依曼结构
- 组成：运算器、控制器、存储器、输入设备、输出设备。
- 特点：
  1. 计算机的数值采用二进制。
  2. 程序指令和数据统一存储。
  3. 计算机应该按照程序顺序执行。

### 指令集相关
- 概念：一个计算机系统支持的所有机器指令的集合，常被看作软硬件的分界面。
- 按操作数数量分类：零地址指令、一地址指令、二地址指令、多地址指令。
- 按寻址空间分类：立即数寻址、寄存器寻址、主存寻址、堆栈寻址。
- 按指令系统复杂程度分类：RISA（精简指令集架构）和CISA（复杂指令集架构）。

### 程序访问局部性
- 时间局部性：最近访问过的内容很可能会在短期内被再次访问。
- 空间局部性：某个存储单元被访问，短时间内其附近的存储单元也会被访问。

### Cache相关
- Cache与主存储器间地址映射方式：直接映射、全相连映射、组相连映射。
- 主存与Cache之间的替换算法：随机法、先进先出、最近最少使用。
- 保证Cache与主存数据一致性的写方式：写直达、写回。
- MESI（缓存一致性协议）：将cacheline状态分为修改、独立、共享和失效。

### 处理器相关
- 传统单核CPU（按冯诺依曼体系结构）：由运算器和控制器组成。
- 多核处理器（按内核对等与否）：同构多核和异构多核。
- 处理器运行状态：内核态和用户态。

### 进程相关
- 进程控制块：进程存在的唯一标志。
- 进程和程序的区别：

| 进程（动态概念）                   | 程序（静态概念）   |
| ---------------------------------- | ------------------ |
| 具有并发特征                       | 没有并发特征       |
| 有生命周期，只在计算机运行期间存在 | 可在外存上长期保存 |

> 注：进程与程序不是一一对应的，同一个程序运行在不同的数据集上成为不同进程；进程实体包括程序、数据和进程控制块。

### 计算机系统的层次结构（从下到上）
0. 数字逻辑层
1. 微体系结构层
2. 传统机器层
3. 操作系统层
4. 汇编语言层
5. 高级语言层
6. 应用程序层

## Linux系统的特点、发展与应用
### 内核概念
内核指一个提供设备驱动、文件系统、进程管理、网络通信等功能的系统软件。

### Linux系统特点
- 开放性
- 良好的可移植性
- 安全稳定
- 广泛的硬件支持
- 支持几乎所有的网络协议及开发语言
- 丰富的应用程序和开发工具
- 自由软件


---

## 第1章 计算机体系结构与操作系统

### 1.1 计算科学与计算机系统

1. 冯诺依曼体系的结构要点:
   - 计算机数制采用二进制,程序指令和数据统一存储,计算机应按照程序顺序执行｡按照冯诺依曼结构设计的计算机由控制器,运算器,存储器和输入设备,输出设备五部分组成｡
   - 控制器和运算器构成现代通用计算机系统的中央处理器(CPU,central processing unit),即传统的单核CPU｡
   - 在主存储器中实现存入要执行的程序和要处理的数据,运行时CPU 将自动并按顺序从主存储器中取出指令一条一条执行｡冯诺依曼结构的计算机系统映射现实世界的时空观,存储体系对应空间域,指令顺序执行过程对应时间域｡

2. 核心组成对应关系:
   - 存储器：存储空间域
   - 控制器、运算器：CPU
   - 指令流：时间域
   - 输入设备、输出设备：数据交互接口

### 1.2 计算机体系结构的基本概念
#### 1.2.2 计算机系统的层次结构
1. 计算机系统是由软件和硬件组成的一个复杂的有机整体｡
2. 计算机系统的层次结构:把计算机系统按功能可分为多级层次结构｡
   - 第0 层:数字逻辑层
   - 第1 层:微体系结构层
   - 第2 层:传统机器层
   - 第3 层:操作系统层
   - 第4 层:汇编语言层
   - 第5 层:高级语言层
   - 第6 层:应用程序层｡
3. 计算机系统结构设计者所关心的是机器语言或汇编语言程序员所看到的计算机结构｡

#### 1.2.3 指令集

1. 指令集是一个计算机系统支持的所有机器指令的集合,它常常被看作软硬件之间的分界面｡
2. 计算机中最普通的指令格式是:操作码+操作数(地址)｡用二进制数据来表示｡
3. 根据操作数的数量不同,可以将指令格式分为:零地址指令,一地址指令､二地址指令､三地址指令和多地址指令｡
4. 寻址方式按指令的寻址空间来分,可分为立即数寻址､寄存器寻址､主存寻址和堆栈寻址4 种｡
5. 指令的功能分类:
   - 从指令的从操用计算机的指令系统中常见的指令类型包括:数据传输指令､算术运算指令､逻辑运算指令､程序控制指令､输入输出指令､处理器控制和调试指令｡
6. 指令集因其系统性和复杂性,也被称为指令集体系结构ISA (instruction set architecture)｡
7. 按照指令系统复杂程度不同,ISA 可分为CISC 和RISC 两大阵营｡CISC 是指复杂指令系统计算机complex instruction set computer; RISC 是指精简指令系统计算机reduced instruction set computer｡
8. CISC 结构追求的目标是强化指令功能,减少程序的指令条数,以达到提高性能的目的｡RISC 通过减少指令种类､规范指令格式和简化寻址方式等方法,方便处理器内部的并行处理,提高超大规模集成电路VLSI 期间的使用效率,从而大幅度的提高处理器的性能｡

#### 1.2.4 存储系统
1. 现代通用计算机中存储系统的层次结构:
   - 第一层寄存器组,第二层高速缓冲存储器(cache),第三层主存储器,第四层辅助存储器,第五层脱机存储器｡存储介质越往上速度越快､价格越高,越往下,容量越大｡
2. 程序访问的局部性包含时间局部性和空间局部性两方面｡
   - 时间局部性是指最近访问过的内容很可能会在短期内被再次访问｡如程序中的循环,循环体的指令要被反复执行｡
   - 空间局部性是指某个存储单位被访问,短时间内其附近的存储单元也会被访问｡
3. "Cache-主存-辅存"是存储体系里最重要的三级层次,通常将其分为"Cache-主存"和"主存-辅存"两个两级存储系统来讨论｡"主存-辅存"两级存储系统也称为虚拟存储系统｡
4. "Cache-主存"层次的理论依据是程序局部性｡
5. Cache 与主存储器间最基本的地址映射方式有三种:全相联映射､直接映射和组相联映射｡
6. 在采用全相联映射和组相联映射的系统中,当主存向Cache 传送一个新块而Cache 已满时,就需要使用替换算法将Cache 中的某一块换出｡常用替换算法有随机法 (RAND),先进先出(FIFO)､最近最少使用法(LRU)｡
7. Cache 读写过程设计数据一致性的问题,一致性是指同一份数据在不同存储位置的多个拷贝应保持一致｡Cache 的一致性体现在连个方面,一是Cache 和主存之间的数据一致性,二是各个处理器内核私有的Cache 之间的数据一致性｡
8. Cache 与主存之间的数据一致性通过Cache 特定的写操作方式来保证:写直达(write through),写回(write back)｡
9. 多核处理器中,处理器内核之间的缓存一致性通过缓存一致性协议类维护,MESI (Modified Exclusive Shared or Invalid)最为经典的缓存一致性协议｡
10. MESI 协议将Cache Line 的状态分成修改(Modify)､独占(Exclusive)､共享(Shared)和失效(Invalid)｡
11. 虚拟存储系统的提出是为了满足应用程序对高速大容量主存的需求,扩大存储系统容量,速度慢｡"主存-辅存"层次的存储管理技术称为虚拟存储管理技术｡

### 1.3 微处理器体系结构

1. 微处理器,即中央处理器CPU 是计算机系统中最重要､最核心的部件｡
2. CPU 单核处理器基本逻辑结构,主要由控制器､运算器和存储单元三部分组成,这三部份由CPU 内部总线相连｡
3. 目前,通用处理器芯片基本上都采用了多核处理器(Chip Multi-Processor,CMP)架构｡
   - 按照计算内核的对等与否,CMP 可分为同构多核和异构多核:计算内核相同､地位对等的称为同构多核;计算内核不同､地位不对等的称为异构多核,多采用"主处理核+协处理核"的设计｡
4. CPU 指令执行过程基本上包含5 个阶段:取指令､指令译码､执行指令､访存取数､结果写回｡

### 1.4 操作系统的基本概念

1. 操作系统是通用计算机系统中不可或缺的系统软件｡
2. 计算机系统的资源按照其作用可大致分为四类:处理器､存储器､I/O 设备和文件｡
3. 对这四类资源的管理就是操作系统内核的主要功能｡

#### 1.4.2 操作系统的基本特征

现代通用操作系统一般具有并发､共享､虚拟和异步这四个基本特征｡
- 并发是指两个或多个事件在同一时间间隔内发生｡
- 共享是指计算机系统中的软硬件资源可被多个并发执行的进程共同使用,而不是被一个进程所独占｡
- 虚拟是指把一个物理上的实体变为一个或多个逻辑上的对应物｡
- 异步又称随机性或不确定性,异步是指在相同的计算机环境和初始条件下,在同一数据集上运行的同一程序每次执行的顺序和所需时间都不一定相同｡(避免混淆:并行是指两个或多个事件在同一时刻发生)

### 1.5 操作系统的基本功能和原理

从资源管理的角度来看,操作系统具备五大基本功能:处理器管理､存储管理､设备管理､文件管理和作业管理｡

#### 1.5.1 处理器管理

处理器管理的功能主要有两个:中断处理和进程管理｡

##### 1.5.1.1 中断处理

1. 在处理器上运行的指令,根据权限可分为两种:
   - 特权指令:只能被操作系统内核使用的指令,这些指令设计改变机器状态､修改寄存器内容､启动设备等敏感操作｡
   - 非特权指令:所有程序都能使同的指令｡
2. 处理器的运行状态一般分为内核态和用户态,在内核态下能执行所有指令,在用户态下只能执行非特权指令｡
3. 用户态切换到内核态3 种方式:系统调用,异常,外围设备的中断｡3 种方式都通过中断机制发生｡
4. 中断概念:中断是指CPU 对系统发生的某个事件做出的一种反应,它使CPU 暂停正在执行的程序,保留现场后自动执行相应的处理程序,处理该事件后,如被中断进程的优先级最高,则返回断点继续执行被"打断"的程序｡
   - 中断源:引起中断的事件或发出中断请求的来源｡
   - 中断请求:中断源向CPU 提出的处理请求｡
   - 断点:发生中断时,被打断程序的暂停点｡
5. 中断概念的另一个发展是访管(即访问管理)指令(或系统调用)的使用｡
6. 中断类型按功能划分(类似IBM 360/370 系统分类法):
   - (1)机器故障中断:机器发生错误时产生,反映硬件执行故障(如电路检验错､电源故障､内存读数错),用于进入诊断程序处理｡
   - (2)I/O 中断:来自通道或外部设备,反映通道/设备工作情况(如打印机打印结束､磁盘传输完成､终端I/O)｡
   - (3)外部中断:来自系统外部装置,反映外界需求(如计时器到时溢出､操作员按控制台按钮､多机系统信号)｡
   - (4)程序性中断:错误使用指令或数据引起,反映程序执行例外情况(如非法操作码､无效地址､运算溢出)｡
   - (5)访管中断:执行"访问管理程序"指令产生,使CPU 从用户态转入管理态,为用户程序提供系统资源服务(如配置通道的系统中,用户程序I/O 请求引起的中断)｡

##### 1.5.1.2 进程管理

1. 进程是计算机中的程序在某数据集合上的一次运行活动,是系统进行资源分配和调度的基本单位｡
2. 进程和程序的联系与区别:
   - 进程是动态概念,程序是静态概念;
   - 进程具有并发特征,程序无;
   - 进程有生命期(仅运行时存在),程序可长期保存在外存;
   - 进程与程序不总是一一对应(一个程序在不同数据集上执行是不同进程);
   - 进程实体组成:程序､数据和控制块,程序仅为指令集合｡
3. 进程控制块(PCB):用于描述进程动态变化过程,是进程存在的唯一标志,系统通过PCB 感知进程存在｡
4. 线程:被处理器调度运行的最小单位,包含在进程中,是进程内单一顺序的控制流;一个进程可并发多个线程,各线程并行执行不同任务｡
5. 进程的状态及转换:
   - 3 种基本状态:运行态(running)､就绪态(ready)､等待态(wait,又称阻塞态blocked 或睡眠态sleep);
   - 实际系统增加状态:新建态(new)､终止态(exit);
   - 状态转换逻辑:新建态→就绪态(加载资源)→运行态(进程调度)→终止态(释放资源);运行态→就绪态(时间片用完);运行态→等待态(出现等待事件);等待态→就绪态(事件处理结束)｡
6. 就绪态特征:已获得除CPU 以外的所有运行所需资源｡

#### 1.5.2 存储管理

1. 将用户源程序变为可在内存中执行的程序步骤:编译,链接,装入｡
2. 存储器管理主要功能:内存空间的分配与回收,地址转换,内存空间的扩充和存储保护｡

#### 1.5.3 设备管理

设备管理模块主要负责处理器内核与外部设备间的数据交互,包括把设备分配给某个请求使用该设备的进程,处理CPU 和设备间I/O 通信,响应设备的中断请求,维护和回收设备等｡

#### 1.5.4 文件管理

1. 负责文件管理的部分称为文件系统,功能包括文件的逻辑组织和物理组织､目录结构和管理等｡
2. 常用文件物理结构有顺序结构､链表结构､索引结构｡

#### 1.5.5 作业管理

1. 作业:用户在一次计算过程中或一个事务处理中要求计算机系统所作工作的总和,是用户向计算机系统提交任务的基本单位｡
2. 作业管理内容:作业的输入和输出,以及作业的调度和控制｡
3. 作业的状态:从提交到结束退出系统,经历提交､后备､执行和完成4 个状态｡

## 第2章 Linux 系统概述

1. Linus Torvalds 负责开发的Linux 只是一个内核｡内核指的是一个提供设备驱动､文件系统､进程管理､网络通信等功能的系统软件,内核并不是一套完整的操作系统,只是操作系统的核心｡
2. Linux 发行版本:Red Hat､Debian Linux､Fedora Core､CentOS､Ubuntu Linux､SuSE Linux､Gentoo Linux､Slackware｡
3. 2019 年截止,世界超级计算机500 强上运行的都是Linux｡安卓系统是基于Linux 的开源系统,是Google 公司为移动终端打造的真正开放和完整的移动软件｡亚马逊云､阿里云､谷歌云都部署在Linux 系统上｡人工智能和区块链的底层也都是Linux｡