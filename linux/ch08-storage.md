# 存储管理
8.1 存储设备的查看
从存储数据的介质上来区分，硬盘可分为机械硬盘（hard disk drive，HDD）和固态硬盘
（solid state disk，SSD），机械硬盘采用磁性碟片存储数据，固态硬盘通过闪存颗粒存储。
机械硬盘的逻辑结构主要分为磁道、扇区和柱面。以下几种，IDE（Integrated Drive
Electronics，电子集成驱动器）硬盘接口；SATA（Serial ATA，串口）接口；SCSI（Small
Computer System Interface，小型计算机系统接口）。
扇区是磁盘的最小存储单位。
固态硬盘和机械硬盘最大的区别就是不再采用盘片存储数据，而采用存储芯片存储数
据。
固态硬盘低能耗、无噪声、抗震动、低散热、体积小和速度快的优势；价格更高，使用寿
命有限。
8.1.2 硬盘识别
8.1.3 存储设备的挂载
挂载指的是将硬件设备的 文件系统 和 Linux 系统中的文件系统，通过 指定目录（作为挂
载点） 进行关联。而将文件系统挂载到 Linux 系统上，需要使用 mount 挂载命令。
为了能够把新建立的文件系统装载到系统目录中,还需要指定该文件系统在整个目录结构
中的位置,称为 挂载点。
所有的硬件设备必须 __ 挂载__ 之后才能使用,有些硬件设备(比如硬盘)在每次系统启动时
会， _ 自动挂载_ 。而有些(比如 U 盘、光盘)则需要 _ 手动挂载_。
1. mount 命令
[root@localhost ~]# mount -l
单纯使用 mount 命令，会显示出系统中已挂载的设备新宁县。使用-l，会额外显示出卷标
名称。
[root@localhost ~]# mount -a
自动检查/etc/fstab 文件中有无因疏漏而未被挂载的设备文件，若有则进行自动挂载操作。
/etc/fstab 文件为自动挂载文件，系统开机时会主动读取文件内容，根据文件配置，系统会
自动挂载指定设备。
[root@localhost ~]# mount [-t 系统类型] [-L 卷标名] [-o 特殊选项] [-n]设备文件名 挂载
点
-t 系统类型：指定欲挂载的文件系统类型。常见的支持类型有 EXT2、EXT3、EXT4、
iso9660、vfat、reiserfs 等。
-L 卷标名：除了使用设备文件名（如/dev/hdc6）之外，还可以利用文件系统的卷标名称
进行挂载。
-n：默认情况下，系统会将实际挂载的情况实时写入/etc/mtab 文件中。但在某些场景下
（如单人维护模式），为避免出现问题，会刻意不写入，此时就需要使用这个选项。
-o 特殊选项：可以指定挂载的额外选项，如读/写权限，同步/异步等。
卸载使用 umount 命令
2. 挂载光盘
建立挂载点目录：
[root@localhost ~]#mkdir /mnt/cdrom/
挂载命令
[root@localhost ~]# mount /dev/cdrom /mnt/cdrom/S
3. 挂载 U 盘
光盘的设备文件名是固定的（/dev/sr0 或/dev/cdrom），U 盘的设备文件名是在插入 U
盘后系统自动分配的。
先以 root 用户身份登录，通过使用 fdisk 命令查看到 U 盘的设备文件名：
[root@localhost ~]# fdisk -l
假若 U 盘是 sda1，接下来要创建挂载点，在目录/mnt 下建立文件夹/usb：
[root@localhost ~]# mkdir /mnt/usb
然后挂载：
[root@localhost ~]# mount -t vfat /dev/sda1 /mnt/usb/
4. 自动挂载
若想实现开机自动挂载某个硬件设备，使用 root 身份在/etc/fstab 文件中添加此设备即
可。
8.2 分区管理
Linux 中分区命令 fdisk 和 parted。fdisk 较常用，但不支持大于 2TB 的分区。大于 2TB 使用
parted 命令，parted 也能分配较小的分区。
8.2.1 fdisk 命令
查询本机可以识别的硬盘和分区：
[root@localhost ~]# fdisk -l
给硬盘分区：
[root@localhost ~]# fdisk 设备文件名
不要在当前的硬盘上尝试使用 fdisk，这会完整删除整个系统。
建立主分区的过程：fdisk 硬盘名—n（新建）—p（建立主分区）—l（指定分区号）—按
Enter 键（默认从柱面 1 开始建立分区）—+5G（指定分区大小）。当然，分区还没有格式
化和挂载，还不能使用。
主分区和扩展分区加起来最多只能建立 4 个，扩展分区最多只能建立 1 个。
所有的分区在建立过程中如果不保存就退出，是不会生效的。使用 q 命令不保存退出，使
用 w 命令，保存退出。若不想重新启动系统可以使用 partprobe 命令，作用是让系统内核
重新读取分区表信息。
8.2.2 parted 命令
parted 命令是可以在命令行直接分区和格式化的，parted 交互模式才是更加常用的命令方
式，进入交互模式命令：
[root@localhost ~]# parted 硬盘设备文件名
在 parted 等待输入交互命令的位置输入 help，可看到在交互模式下支持的所有命令。
分区完成后，需要进行格式化。使用 parted 交互命令格式化，则只能格式化成 ext2 文件系
统。需要使用 mkfs 命令（不是 parted 交互命令中的 mkfs，而是系统命令 mkfs）。parted
命令还可以调整分区的大小。
parted 所有的操作都是立即生效的！！
8.3 磁盘管理工具
8.3.1 df 命令
用于显示 Linux 系统中个文件系统的硬盘使用情况，包括文件系统所在硬盘分区的总容量、
已使用的容量、剩余容量等。与整个文件系统有关的数据都保存在超级块（Super Block）. [root@localhost ~]# df [选项] [目录或文件名] -a：显示所有文件系统信息，包括 Linux 系统特有的/proc、/sysfs 等文件系统。
-h：使用人们习惯的 MB 或 GB 等单位自行显示容量。
-i：不显示硬盘容量，而显示 inode 的数量。
无选项默认将系统内文件系统信息 KB 为单位显示出来。
df 命令后添加目录名，会自动分析该目录所在的分区，并将所在分区的有关信息显示出来。
8.3.2 du 命令
统计目录或文件所占磁盘空间容量的命令。
[root@localhost ~]# du [选项] [目录或文件名] -a：显示所有子目录和子文件的磁盘占用量。
-h：使用习惯单位显示磁盘占用量
-s：统计总磁盘占用量，而不列出子目录和子文件的从磁盘占用量。
不带选项为统计当前目录的总磁盘占用量，同时会统计当前目录下所有子目录的磁盘占用
量，不统计子文件，默认单位 KB。
当删除一个文件时，不是马上就在文件系统中消失，当所有程序都不用该文件时，才会根
据操作系统的计算规则释放已经删除的文件空间。
df 命令能看到已经删除的文件，计算大小的时候，把这一部分的空间也加上了，因此更精
确。
8.3.3 fsck 命令
检查文件系统并尝试修复出现的错误。
[root@localhost ~]# fsck [选项] 分区设备文件名
-a：自动修复文件系统，没有任何提示信息。
-r：交互式修复模式，修改文件前会进行询问，让用户确认并决定处理方式。
fsck 命令修复磁盘分区以后，若发现分区中有文件丢失，可以到对应的“lost+found”目录中
去查找，但由于无法通过文件名称分辨各个文件，可利用 file 命令查看文件系统类型，进
而判断哪个是用户需要的文件。
8.4 磁盘阵列